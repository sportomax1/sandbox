<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Firebase Admin Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #f5f5f5;
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      text-align: center;
      margin-bottom: 30px;
    }
    .controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 15px;
    }
    .table-selector {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .table-selector select {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
      background-color: white;
    }
    .action-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: left;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.5s ease, transform 0.5s ease;
    }
    th {
      background-color: #4CAF50;
      color: white;
      font-weight: bold;
      opacity: 1;
      transform: translateY(0);
    }
    tr.animate-in td {
      opacity: 1;
      transform: translateY(0);
    }
    tr:nth-child(even) {
      background-color: #f2f2f2;
    }
    tr:hover {
      background-color: #e8f5e8;
      transform: translateY(-1px);
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
    }
    tr.animate-in:hover {
      transform: translateY(-1px);
    }
    .timestamp {
      font-size: 0.9em;
      color: #666;
    }
    .message-text, .student-info {
      max-width: 300px;
      word-wrap: break-word;
    }
    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
      font-size: 18px;
    }
    .record-count {
      margin: 10px 0;
      font-weight: bold;
      color: #333;
      font-size: 18px;
    }
    .no-data {
      text-align: center;
      padding: 40px;
      color: #999;
      font-style: italic;
    }
    button {
      background-color: #4CAF50;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin: 2px;
      font-size: 14px;
    }
    button:hover {
      background-color: #45a049;
    }
    .btn-secondary {
      background-color: #2196F3;
    }
    .btn-secondary:hover {
      background-color: #1976D2;
    }
    .auto-refresh-on {
      background-color: #4CAF50 !important;
      animation: pulse 2s infinite;
    }
    .auto-refresh-off {
      background-color: #9E9E9E !important;
    }
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.7; }
      100% { opacity: 1; }
    }
    .live-indicator {
      display: inline-block;
      width: 8px;
      height: 8px;
      background-color: #4CAF50;
      border-radius: 50%;
      margin-right: 5px;
      animation: blink 1s infinite;
    }
    
    /* Database Overview Styles */
    .db-overview {
      margin-bottom: 30px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 10px;
      padding: 20px;
      color: white;
    }
    .db-overview h2 {
      margin: 0 0 15px 0;
      color: white;
      text-align: center;
    }
    .db-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    .db-stat-card {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      padding: 15px;
      text-align: center;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    .db-stat-card h3 {
      margin: 0 0 10px 0;
      font-size: 18px;
      color: #fff;
    }
    .db-stat-value {
      font-size: 24px;
      font-weight: bold;
      color: #FFD700;
      margin-bottom: 5px;
    }
    .db-stat-label {
      font-size: 12px;
      opacity: 0.8;
    }
    .db-controls {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    .db-controls button {
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .db-controls button:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
    }
    .query-results {
      margin-top: 15px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      padding: 15px;
      max-height: 300px;
      overflow-y: auto;
      display: none;
    }
    .query-results pre {
      margin: 0;
      white-space: pre-wrap;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      color: #fff;
    }
    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0.3; }
    }
    
    .table-loading {
      opacity: 0.7;
      pointer-events: none;
      position: relative;
    }
    
    .table-loading::after {
      content: 'Loading records...';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255,255,255,0.95);
      padding: 15px 25px;
      border-radius: 5px;
      font-weight: bold;
      color: #4CAF50;
      z-index: 100;
      box-shadow: 0 2px 10px rgba(0,0,0,0.15);
    }
    .btn-danger {
      background-color: #f44336;
    }
    .btn-danger:hover {
      background-color: #da190b;
    }
    .edit-btn, .delete-btn {
      padding: 5px 10px;
      margin: 2px;
      border: none;
      border-radius: 3px;
      cursor: pointer;
      font-size: 12px;
    }
    .edit-btn {
      background-color: #4CAF50;
      color: white;
    }
    .edit-btn:hover {
      background-color: #45a049;
    }
    .delete-btn {
      background-color: #f44336;
      color: white;
    }
    .delete-btn:hover {
      background-color: #da190b;
    }
    .edit-input-admin {
      width: 200px;
      padding: 3px;
      margin-right: 5px;
    }
    .table-info {
      background-color: #e3f2fd;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 20px;
    }
    .table-info h3 {
      margin: 0 0 10px 0;
      color: #1976d2;
    }
    .table-info p {
      margin: 0;
      color: #555;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Firebase Admin Dashboard</h1>
    
    <!-- Database Overview Section -->
    <div class="db-overview">
      <h2>üóÑÔ∏è Database Overview</h2>
      <div class="db-stats" id="dbStats">
        <div class="db-stat-card">
          <h3>üí¨ Messages</h3>
          <div class="db-stat-value" id="messagesCount">-</div>
          <div class="db-stat-label">chat messages</div>
        </div>
        <div class="db-stat-card">
          <h3>üë• Students</h3>
          <div class="db-stat-value" id="studentsCount">-</div>
          <div class="db-stat-label">student records</div>
        </div>
        <div class="db-stat-card">
          <h3>üé≤ Board Games</h3>
          <div class="db-stat-value" id="bggCount">-</div>
          <div class="db-stat-label">games in collection</div>
        </div>
        <div class="db-stat-card">
          <h3>üìä Total Records</h3>
          <div class="db-stat-value" id="totalCount">-</div>
          <div class="db-stat-label">across all tables</div>
        </div>
      </div>
      <div class="db-controls">
        <button onclick="showAllData()">üìã View All Data</button>
        <button onclick="showTableStructure()">üîç Table Structure</button>
        <button onclick="refreshOverview()">üîÑ Refresh Overview</button>
        <button onclick="exportAllData()">üíæ Export All</button>
      </div>
      <div class="query-results" id="queryResults">
        <pre id="queryContent"></pre>
      </div>
    </div>
    
    <div class="controls">
      <div class="table-selector">
        <label for="tableSelect"><strong>Select Data Table:</strong></label>
        <select id="tableSelect" onchange="changeTable()">
          <option value="messages">Chat Messages</option>
          <option value="students">Student Records</option>
          <option value="bggCollection">BoardGameGeek Collection</option>
        </select>
      </div>
      <div class="action-buttons">
        <button onclick="loadCurrentTable()" class="btn-secondary">Refresh Data</button>
        <button onclick="toggleAutoRefresh()" id="autoRefreshBtn" class="btn-secondary">üîÑ Auto-Refresh: ON</button>
        <button onclick="exportToCSV()" class="btn-secondary">Export to CSV</button>
        <button onclick="clearAllData()" class="btn-danger">Clear All Data</button>
      </div>
    </div>

    <div class="table-info" id="tableInfo">
      <h3 id="tableTitle">Chat Messages</h3>
      <p id="tableDescription">View and manage chat messages from the lobby.</p>
    </div>

    <div class="record-count" id="recordCount">Loading...</div>
    
    <div class="loading" id="loading">Loading data...</div>
    <div class="no-data" id="noData" style="display: none;">No data found in this table.</div>
    
    <table id="dataTable" style="display: none;">
      <thead>
        <tr id="tableHeaders">
          <!-- Headers will be populated dynamically -->
        </tr>
      </thead>
      <tbody id="dataTableBody">
        <!-- Data will be populated dynamically -->
      </tbody>
    </table>
  </div>

  <script type="module">
    // Import Firebase modules
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import { getDatabase, ref, get, update, remove, onValue, off } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-database.js";

    // Firebase config (same as your chat app)
    const firebaseConfig = {
      apiKey: "AIzaSyCDCwNxZto-1OFSkpFOHY_CvXig99TB_po",
      authDomain: "chatlobby-6f969.firebaseapp.com",
      databaseURL: "https://chatlobby-6f969-default-rtdb.firebaseio.com/",
      projectId: "chatlobby-6f969",
      storageBucket: "chatlobby-6f969.firebasestorage.app",
      messagingSenderId: "939856304247",
      appId: "1:939856304247:web:353e71ea8e68d8467e8e72",
      measurementId: "G-J2GYLYM03S"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Current table state
    let currentTable = 'messages';
    let currentListener = null;
    let autoRefreshEnabled = true;
    
    // Table configurations
    const tableConfigs = {
      messages: {
        title: 'Chat Messages',
        description: 'View and manage chat messages from the lobby.',
        headers: ['ID', 'Name', 'Message', 'Timestamp', 'Date & Time', 'Actions'],
        csvHeaders: 'ID,Name,Message,Timestamp,DateTime',
        sortField: 'timestamp',
        filename: 'chat_messages.csv'
      },
      students: {
        title: 'Student Records',
        description: 'View and manage student information and enrollment data.',
        headers: ['ID', 'Student ID', 'Name', 'Email', 'Phone', 'Grade', 'Major', 'Status', 'Enrollment Date', 'Actions'],
        csvHeaders: 'ID,Student ID,First Name,Last Name,Email,Phone,Grade,Major,Status,Enrollment Date,Notes',
        sortField: 'studentId',
        filename: 'student_records.csv'
      },
      bggCollection: {
        title: 'BoardGameGeek Collection',
        description: 'View BoardGameGeek collection data fetched from the BGG API.',
        headers: ['Username', 'Game Count', 'Last Updated', 'Actions'],
        csvHeaders: 'Username,Game Count,Last Updated',
        sortField: 'lastUpdated',
        filename: 'bgg_collection_summary.csv'
      }
    };

    // DOM elements
    const tableSelect = document.getElementById('tableSelect');
    const tableTitle = document.getElementById('tableTitle');
    const tableDescription = document.getElementById('tableDescription');
    const loading = document.getElementById('loading');
    const noData = document.getElementById('noData');
    const dataTable = document.getElementById('dataTable');
    const tableHeaders = document.getElementById('tableHeaders');
    const dataTableBody = document.getElementById('dataTableBody');
    const recordCount = document.getElementById('recordCount');

    // Change table function
    window.changeTable = function() {
      // Stop current listener before switching tables
      stopAutoRefresh();
      
      currentTable = tableSelect.value;
      updateTableInfo();
      
      if (autoRefreshEnabled) {
        startAutoRefresh();
      } else {
        loadCurrentTable();
      }
    };

    // Toggle auto-refresh
    window.toggleAutoRefresh = function() {
      autoRefreshEnabled = !autoRefreshEnabled;
      const btn = document.getElementById('autoRefreshBtn');
      
      if (autoRefreshEnabled) {
        btn.textContent = 'üîÑ Auto-Refresh: ON';
        btn.style.backgroundColor = '#4CAF50';
        startAutoRefresh();
      } else {
        btn.textContent = '‚è∏Ô∏è Auto-Refresh: OFF';
        btn.style.backgroundColor = '#9E9E9E';
        stopAutoRefresh();
      }
    };

    // Start auto-refresh listener
    function startAutoRefresh() {
      stopAutoRefresh(); // Stop any existing listener first
      
      const dataRef = ref(db, currentTable);
      currentListener = onValue(dataRef, (snapshot) => {
        loadDataFromSnapshot(snapshot);
      }, (error) => {
        console.error(`Auto-refresh error for ${currentTable}:`, error);
        recordCount.textContent = `Auto-refresh error: ${error.message}`;
      });
    }

    // Stop auto-refresh listener
    function stopAutoRefresh() {
      if (currentListener) {
        off(ref(db, currentTable), 'value', currentListener);
        currentListener = null;
      }
    }

    // Load data from Firebase snapshot (for real-time updates)
    function loadDataFromSnapshot(snapshot) {
      clearTableAnimations();
      dataTableBody.innerHTML = '';
      
      if (snapshot.exists()) {
        const data = snapshot.val();
        let dataArray;
        
        // Handle different data structures
        if (currentTable === 'bggCollection') {
          // BGG collection is stored as a single object, not a collection
          dataArray = [{ id: 'bggCollection', ...data }];
        } else {
          // Normal collections (messages, students)
          dataArray = Object.entries(data).map(([id, itemData]) => ({
            id,
            ...itemData
          }));
        }

        // Sort based on table configuration
        const config = tableConfigs[currentTable];
        if (config.sortField) {
          if (currentTable === 'messages') {
            dataArray.sort((a, b) => b.timestamp - a.timestamp); // Newest first for messages
          } else {
            dataArray.sort((a, b) => {
              const aVal = a[config.sortField] || '';
              const bVal = b[config.sortField] || '';
              return aVal.toString().localeCompare(bVal.toString());
            });
          }
        }

        // Populate table based on current table type
        if (currentTable === 'messages') {
          populateMessagesTable(dataArray);
        } else if (currentTable === 'students') {
          populateStudentsTable(dataArray);
        } else if (currentTable === 'bggCollection') {
          populateBGGTable(dataArray);
        }

        // Animate table rows after population
        animateTableRows();

        recordCount.textContent = `Total records: ${dataArray.length}`;
        if (autoRefreshEnabled) {
          recordCount.innerHTML = `<span class="live-indicator"></span>Total records: ${dataArray.length} (Live Updates)`;
        } else {
          recordCount.textContent = `Total records: ${dataArray.length}`;
        }
        showTable();
      } else {
        recordCount.textContent = `No ${currentTable} found`;
        if (autoRefreshEnabled) {
          recordCount.innerHTML = `<span class="live-indicator"></span>No ${currentTable} found (Live Updates)`;
        } else {
          recordCount.textContent = `No ${currentTable} found`;
        }
        showNoData();
      }
    }

    // Update table info display
    function updateTableInfo() {
      const config = tableConfigs[currentTable];
      tableTitle.textContent = config.title;
      tableDescription.textContent = config.description;
      
      // Update headers
      tableHeaders.innerHTML = '';
      config.headers.forEach(header => {
        const th = document.createElement('th');
        th.textContent = header;
        tableHeaders.appendChild(th);
      });
    }

    // Load current table data (manual refresh)
    window.loadCurrentTable = async function() {
      // If auto-refresh is on, just restart the listener
      if (autoRefreshEnabled) {
        startAutoRefresh();
        return;
      }
      
      // Manual loading when auto-refresh is off
      showLoading();
      
      try {
        const dataRef = ref(db, currentTable);
        const snapshot = await get(dataRef);
        loadDataFromSnapshot(snapshot);
      } catch (error) {
        console.error(`Error loading ${currentTable}:`, error);
        recordCount.textContent = `Error loading ${currentTable}: ${error.message}`;
        showNoData();
      }
    };

    // Populate messages table
    function populateMessagesTable(messages) {
      messages.forEach(message => {
        const row = dataTableBody.insertRow();
        const date = new Date(message.timestamp);
        
        row.insertCell(0).textContent = message.id;
        row.insertCell(1).textContent = message.name || 'Anonymous';
        row.insertCell(2).innerHTML = `<div class="message-text" data-id="${message.id}">${message.text}</div>`;
        row.insertCell(3).innerHTML = `<div class="timestamp">${message.timestamp}</div>`;
        row.insertCell(4).textContent = date.toLocaleString();
        
        // Actions cell
        const actionsCell = row.insertCell(5);
        actionsCell.innerHTML = `
          <button onclick="editRecord('${message.id}')" class="edit-btn">Edit</button>
          <button onclick="deleteRecord('${message.id}', '${currentTable}')" class="delete-btn">Delete</button>
        `;
      });
    }

    // Populate students table
    function populateStudentsTable(students) {
      students.forEach(student => {
        const row = dataTableBody.insertRow();
        
        row.insertCell(0).textContent = student.id;
        row.insertCell(1).textContent = student.studentId || '-';
        row.insertCell(2).textContent = `${student.firstName || ''} ${student.lastName || ''}`.trim() || '-';
        row.insertCell(3).textContent = student.email || '-';
        row.insertCell(4).textContent = student.phone || '-';
        row.insertCell(5).textContent = student.grade || '-';
        row.insertCell(6).textContent = student.major || '-';
        row.insertCell(7).textContent = student.status || 'active';
        row.insertCell(8).textContent = student.enrollmentDate || '-';
        
        // Actions cell
        const actionsCell = row.insertCell(9);
        actionsCell.innerHTML = `
          <button onclick="editRecord('${student.id}')" class="edit-btn">Edit</button>
          <button onclick="deleteRecord('${student.id}', '${currentTable}')" class="delete-btn">Delete</button>
        `;
      });
    }

    // Populate BGG collection table
    function populateBGGTable(collections) {
      // BGG collection is stored as a single object, not an array
      if (collections.length === 1) {
        const collection = collections[0];
        const row = dataTableBody.insertRow();
        const lastUpdate = collection.lastUpdated ? new Date(collection.lastUpdated).toLocaleString() : 'N/A';
        
        row.insertCell(0).textContent = collection.username || 'Unknown';
        row.insertCell(1).textContent = collection.gameCount || '0';
        row.insertCell(2).textContent = lastUpdate;
        
        // Actions cell
        const actionsCell = row.insertCell(3);
        actionsCell.innerHTML = `
          <button onclick="viewBGGDetails()" class="btn-secondary">View Games</button>
          <button onclick="deleteRecord('bggCollection', '${currentTable}')" class="delete-btn">Delete</button>
        `;
      }
    }

    // View BGG collection details
    window.viewBGGDetails = function() {
      window.open('boardgames.html', '_blank');
    };

    // Animate table rows with delayed scrolling effect
    function animateTableRows() {
      const table = document.getElementById('dataTable');
      table.classList.add('table-loading');
      
      const rows = Array.from(dataTableBody.querySelectorAll('tr'));
      const delay = 30; // Delay between each row animation (milliseconds)
      
      rows.forEach((row, index) => {
        setTimeout(() => {
          row.classList.add('animate-in');
        }, index * delay);
      });
      
      // Remove loading state after all animations complete
      const totalDelay = rows.length * delay + 500; // Extra time for last animation
      setTimeout(() => {
        table.classList.remove('table-loading');
      }, totalDelay);
    }

    // Clear animations when loading new data
    function clearTableAnimations() {
      const rows = Array.from(dataTableBody.querySelectorAll('tr'));
      rows.forEach(row => {
        row.classList.remove('animate-in');
      });
    }

    // Show/hide functions
    function showLoading() {
      loading.style.display = 'block';
      dataTable.style.display = 'none';
      noData.style.display = 'none';
    }

    function showTable() {
      loading.style.display = 'none';
      dataTable.style.display = 'table';
      noData.style.display = 'none';
    }

    function showNoData() {
      loading.style.display = 'none';
      dataTable.style.display = 'none';
      noData.style.display = 'block';
    }

    // Edit record function
    window.editRecord = function(recordId) {
      if (currentTable === 'messages') {
        editMessageAdmin(recordId);
      } else if (currentTable === 'students') {
        editStudentAdmin(recordId);
      }
    };

    // Delete record function
    window.deleteRecord = async function(recordId, tableName) {
      if (confirm(`Are you sure you want to delete this ${tableName.slice(0, -1)}? This action cannot be undone.`)) {
        try {
          await remove(ref(db, `${tableName}/${recordId}`));
          recordCount.textContent = `Record deleted successfully!`;
          loadCurrentTable(); // Reload to show changes
        } catch (error) {
          console.error('Error deleting record:', error);
          alert('Failed to delete record: ' + error.message);
        }
      }
    };

    // Clear all data function
    window.clearAllData = async function() {
      const tableName = tableConfigs[currentTable].title;
      if (confirm(`Are you sure you want to DELETE ALL ${tableName.toUpperCase()}? This action CANNOT be undone!`)) {
        if (confirm(`This will permanently delete ALL data in the ${tableName} table. Type "DELETE" to confirm.`)) {
          try {
            await remove(ref(db, currentTable));
            alert(`All ${tableName.toLowerCase()} have been deleted.`);
            loadCurrentTable();
          } catch (error) {
            console.error('Error clearing data:', error);
            alert('Failed to clear data: ' + error.message);
          }
        }
      }
    };

    // Export to CSV function
    window.exportToCSV = function() {
      const table = document.getElementById('dataTable');
      if (table.style.display === 'none') {
        alert('No data to export. Please load data first.');
        return;
      }

      const config = tableConfigs[currentTable];
      let csv = config.csvHeaders + '\n';
      const rows = table.querySelectorAll('tbody tr');
      
      rows.forEach(row => {
        const cells = row.querySelectorAll('td');
        const rowData = [];
        
        // Skip the actions column (last one)
        for (let i = 0; i < cells.length - 1; i++) {
          let text = cells[i].textContent.trim();
          if (text.includes(',') || text.includes('"')) {
            text = '"' + text.replace(/"/g, '""') + '"';
          }
          rowData.push(text);
        }
        
        csv += rowData.join(',') + '\n';
      });

      // Download CSV file
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = config.filename;
      a.click();
      window.URL.revokeObjectURL(url);
    };

    // Message-specific edit function
    window.editMessageAdmin = function(messageId) {
      const messageDiv = document.querySelector(`[data-id="${messageId}"]`);
      if (!messageDiv) return;
      
      const currentText = messageDiv.textContent;
      
      const input = document.createElement('input');
      input.type = 'text';
      input.value = currentText;
      input.className = 'edit-input-admin';
      
      const saveBtn = document.createElement('button');
      saveBtn.textContent = 'Save';
      saveBtn.onclick = () => saveMessageAdmin(messageId, input.value);
      
      const cancelBtn = document.createElement('button');
      cancelBtn.textContent = 'Cancel';
      cancelBtn.onclick = () => loadCurrentTable();
      
      messageDiv.innerHTML = '';
      messageDiv.appendChild(input);
      messageDiv.appendChild(saveBtn);
      messageDiv.appendChild(cancelBtn);
      input.focus();
    };

    // Save message function
    window.saveMessageAdmin = async function(messageId, newText) {
      if (newText.trim() === '') {
        alert('Message cannot be empty!');
        return;
      }
      
      try {
        await update(ref(db, `messages/${messageId}`), {
          text: newText.trim(),
          edited: true,
          editedAt: Date.now()
        });
        loadCurrentTable();
      } catch (error) {
        console.error('Error updating message:', error);
        alert('Failed to update message: ' + error.message);
      }
    };

    // Student-specific edit function
    window.editStudentAdmin = function(studentId) {
      alert(`Student editing in admin panel coming soon! For now, please use the students.html page to edit student "${studentId}".`);
    };

    // Initialize
    updateTableInfo();
    
    // Start with auto-refresh enabled
    if (autoRefreshEnabled) {
      startAutoRefresh();
    } else {
      loadCurrentTable();
    }

    // Cleanup listeners when page is closed
    window.addEventListener('beforeunload', () => {
      stopAutoRefresh();
    });
  </script>
</body>
</html>